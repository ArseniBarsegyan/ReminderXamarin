<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:base="clr-namespace:ReminderXamarin.ViewModels.Base;assembly=ReminderXamarin"
             xmlns:elements="clr-namespace:ReminderXamarin.Elements;assembly=ReminderXamarin"
             xmlns:abstractions="clr-namespace:ImageCircle.Forms.Plugin.Abstractions;assembly=ImageCircle.Forms.Plugin"
             xmlns:extensions="clr-namespace:ReminderXamarin.Extensions;assembly=ReminderXamarin"
             x:Class="ReminderXamarin.Views.AchievementEditView"
             Title="{Binding Title}"
             BackgroundColor="White"
             base:ViewModelHelper.AutoWireViewModel="True">
    <ContentPage.ToolbarItems>
        <ToolbarItem Order="Primary" Icon="delete.png" Command="{Binding DeleteAchievementCommand}" />
    </ContentPage.ToolbarItems>
    <ContentPage.Content>
        <AbsoluteLayout AbsoluteLayout.LayoutBounds="0,0,1,1" AbsoluteLayout.LayoutFlags="All">
            <elements:BlurredImage x:Name="BackgroundImage"
                                   Aspect="AspectFill"
                                   AbsoluteLayout.LayoutBounds="0,0,1,100" 
                                   AbsoluteLayout.LayoutFlags="PositionProportional, WidthProportional" />

            <abstractions:CircleImage x:Name="AchievementImage"
                                      Aspect="AspectFill"
                                      HorizontalOptions="Center"
                                      VerticalOptions="Start"
                                      HeightRequest="120"
                                      WidthRequest="120"
                                      AbsoluteLayout.LayoutBounds="0.5,40,120,120" 
                                      AbsoluteLayout.LayoutFlags="XProportional"
                                      Source="{Binding ImageContent, Converter={StaticResource EmptyByteToImageSourceConverter}}"
                                      Style="{StaticResource UserImageStyle}">
                <abstractions:CircleImage.GestureRecognizers>
                    <TapGestureRecognizer Tapped="AchievementImage_OnTapped" NumberOfTapsRequired="1" />
                </abstractions:CircleImage.GestureRecognizers>
            </abstractions:CircleImage>

            <StackLayout x:Name="AchievementInfoLayout" 
                         AbsoluteLayout.LayoutBounds="0.5,180,1,1"
                         AbsoluteLayout.LayoutFlags="XProportional, SizeProportional">
                <Label Text="{Binding Title}" FontSize="Medium" HorizontalOptions="Center" />

                <Label Text="{extensions:Translate AchievementName}" HorizontalOptions="Start" />
                <Entry x:Name="TitleEntry" Text="{Binding Title}" HorizontalOptions="FillAndExpand" />

                <Label Text="{extensions:Translate Description}" HorizontalOptions="Start" />
                <Editor x:Name="DescriptionEditor"
                        Text="{Binding Description}"
                        TextChanged="DescriptionEditor_OnTextChanged"
                        HorizontalOptions="FillAndExpand"
                        VerticalOptions="FillAndExpand" />

                <ListView x:Name="AchievementSteps">
                    <ListView.Footer>
                        <Button Text="Add step" Command="{Binding AddStepCommand}" />
                    </ListView.Footer>
                </ListView>
            </StackLayout>
        </AbsoluteLayout>
    </ContentPage.Content>
</ContentPage>