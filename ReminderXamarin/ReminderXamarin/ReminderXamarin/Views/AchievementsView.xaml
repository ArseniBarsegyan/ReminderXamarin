<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"             
             xmlns:abstractions="clr-namespace:ImageCircle.Forms.Plugin.Abstractions;assembly=ImageCircle.Forms.Plugin"
             xmlns:extensions="clr-namespace:ReminderXamarin.Extensions;assembly=ReminderXamarin"
             xmlns:converters="clr-namespace:ReminderXamarin.Converters;assembly=ReminderXamarin"
             xmlns:base="clr-namespace:ReminderXamarin.ViewModels.Base;assembly=ReminderXamarin"
             xmlns:elements="clr-namespace:ReminderXamarin.Elements;assembly=ReminderXamarin"
             x:Class="ReminderXamarin.Views.AchievementsView"
             Title="{extensions:Translate Achievements}"
             BackgroundColor="{DynamicResource AchievementsViewBackground}"
             base:ViewModelHelper.AutoWireViewModel="True">
    <ContentPage.Resources>
      <ResourceDictionary>
          <converters:AchievementSpentTimePresentationConverter x:Key="SpentTimePresentationConverter" />
          <converters:NumberToColorConverter x:Key="NumberToColorConverter" />
      </ResourceDictionary>
    </ContentPage.Resources>
    <ContentPage.Content>
        <AbsoluteLayout AbsoluteLayout.LayoutBounds="0,0,1,1" 
                        AbsoluteLayout.LayoutFlags="All">
            <!-- List of achievements -->
            <CollectionView x:Name="AchievementsCollectionView"
                            AbsoluteLayout.LayoutBounds="0,0,1,1" 
                            AbsoluteLayout.LayoutFlags="All"
                            ItemsSource="{Binding Achievements}" 
                            ItemSizingStrategy="MeasureFirstItem">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" 
                                     Span="3" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <StackLayout Padding="5">
                            <AbsoluteLayout x:Name="ImageViewLayout" 
                                            AbsoluteLayout.LayoutBounds="0,0,1,1" 
                                            AbsoluteLayout.LayoutFlags="All"  
                                            HeightRequest="120"
                                            Padding="5">
                                <AbsoluteLayout.GestureRecognizers>
                                    <TapGestureRecognizer NumberOfTapsRequired="1" 
                                                          Tapped="AchievementsList_OnItemSelected" />
                                </AbsoluteLayout.GestureRecognizers>
                                <!-- Hidden field for Id -->
                                <Label IsVisible="False" 
                                       Text="{Binding Id, StringFormat='{0}'}" />
                                <abstractions:CircleImage Source="{Binding ImageContent, 
                                                                   Converter={StaticResource ByteToImageSourceConverter}}"
                                                          Aspect="AspectFill"
                                                          AbsoluteLayout.LayoutBounds="0,0,90,90" 
                                                          AbsoluteLayout.LayoutFlags="PositionProportional"
                                                          VerticalOptions="Center"
                                                          HorizontalOptions="Center"
                                                          HeightRequest="90"
                                                          WidthRequest="90">
                                </abstractions:CircleImage>

                                <Button AbsoluteLayout.LayoutBounds="1,1,50,50" 
                                        TextColor="White"
                                        BackgroundColor="{Binding GeneralTimeSpent, 
                                                                  Converter={StaticResource NumberToColorConverter}}"
                                        AbsoluteLayout.LayoutFlags="PositionProportional" 
                                        Text="{Binding GeneralTimeSpent, 
                                                       Converter={StaticResource SpentTimePresentationConverter}}" 
                                        HeightRequest="50" 
                                        WidthRequest="50" 
                                        CornerRadius="25"
                                        FontSize="Micro" />

                            </AbsoluteLayout>
                        </StackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <elements:FloatingActionButton x:Name="CreateAchievementButton" 
                                           Command="{Binding NavigateToAchievementEditViewCommand}"
                                           ImageSource="add.png" 
                                           ButtonColor="{DynamicResource SubmitButtonBackground}"
                                           AbsoluteLayout.LayoutBounds="0.95,0.95,60,60" 
                                           AbsoluteLayout.LayoutFlags="PositionProportional">
                <elements:FloatingActionButton.CommandParameter>
                    <x:Int32>0</x:Int32>
                </elements:FloatingActionButton.CommandParameter>
            </elements:FloatingActionButton>
        </AbsoluteLayout>
    </ContentPage.Content>
</ContentPage>