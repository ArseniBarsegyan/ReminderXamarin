<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"             
             xmlns:abstractions="clr-namespace:ImageCircle.Forms.Plugin.Abstractions;assembly=ImageCircle.Forms.Plugin"
             xmlns:extensions="clr-namespace:ReminderXamarin.Extensions;assembly=ReminderXamarin"
             xmlns:converters="clr-namespace:ReminderXamarin.Converters;assembly=ReminderXamarin"
             xmlns:base="clr-namespace:ReminderXamarin.ViewModels.Base;assembly=ReminderXamarin"
             x:Class="ReminderXamarin.Views.AchievementsView"
             Title="{extensions:Translate Achievements}"
             BackgroundColor="{DynamicResource ViewBackground}"
             base:ViewModelHelper.AutoWireViewModel="True">
    <ContentPage.Resources>
      <ResourceDictionary> 
          <converters:AchievementSpentTimePresentationConverter x:Key="SpentTimePresentationConverter" />
          <converters:NumberToColorConverter x:Key="NumberToColorConverter" />
      </ResourceDictionary>
    </ContentPage.Resources>
    <ContentPage.Content>
        <AbsoluteLayout AbsoluteLayout.LayoutBounds="0,0,1,1" 
                        AbsoluteLayout.LayoutFlags="All">
            <!-- List of achievements -->
            <CollectionView x:Name="AchievementsCollectionView"
                            AbsoluteLayout.LayoutBounds="0,0,1,1" 
                            AbsoluteLayout.LayoutFlags="All"
                            ItemsSource="{Binding Achievements}"
                            SelectionMode="Single"
                            SelectionChangedCommand="{Binding NavigateToAchievementEditViewCommand}"
                            SelectionChangedCommandParameter="{Binding Source={x:Reference AchievementsCollectionView}, 
                                                                       Path=SelectedItem.Id}"
                            ItemSizingStrategy="MeasureFirstItem">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" 
                                     Span="3" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <StackLayout Padding="5">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroupList>
                                    <VisualStateGroup x:Name="CommonStates">
                                        <VisualState x:Name="Normal" />
                                        <VisualState x:Name="Selected">
                                            <VisualState.Setters>
                                                <Setter Property="BackgroundColor" Value="{DynamicResource Selection}" />
                                            </VisualState.Setters>
                                        </VisualState>
                                    </VisualStateGroup>
                                </VisualStateGroupList>
                            </VisualStateManager.VisualStateGroups>
                            <AbsoluteLayout x:Name="ImageViewLayout"
                                            AbsoluteLayout.LayoutBounds="0,0,1,1"
                                            AbsoluteLayout.LayoutFlags="All"
                                            HeightRequest="120"
                                            Padding="5">
                                <abstractions:CircleImage Source="{Binding ImageContent, 
                                                                   Converter={StaticResource ByteToImageSourceConverter}}"
                                                          Aspect="AspectFill"
                                                          AbsoluteLayout.LayoutBounds="0,0,90,90" 
                                                          AbsoluteLayout.LayoutFlags="PositionProportional"
                                                          VerticalOptions="Center"
                                                          HorizontalOptions="Center"
                                                          HeightRequest="90"
                                                          WidthRequest="90" />

                                <Button AbsoluteLayout.LayoutBounds="1,1,50,50" 
                                        TextColor="White"
                                        BackgroundColor="{Binding GeneralTimeSpent, 
                                                                  Converter={StaticResource NumberToColorConverter}}"
                                        AbsoluteLayout.LayoutFlags="PositionProportional" 
                                        Text="{Binding GeneralTimeSpent, 
                                                       Converter={StaticResource SpentTimePresentationConverter}}" 
                                        HeightRequest="50" 
                                        WidthRequest="50" 
                                        CornerRadius="25"
                                        FontSize="Micro" />
                                
                            </AbsoluteLayout>
                        </StackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <ImageButton x:Name="CreateAchievementButton" 
                         Padding="20"
                         Command="{Binding NavigateToAchievementEditViewCommand}"
                         Source="add.png" 
                         BackgroundColor="{DynamicResource SubmitButtonBackground}"
                         CornerRadius="30"
                         AbsoluteLayout.LayoutBounds="0.97,0.98,60,60" 
                         AbsoluteLayout.LayoutFlags="PositionProportional">
                <ImageButton.CommandParameter>
                    <x:Int32>0</x:Int32>
                </ImageButton.CommandParameter>
            </ImageButton>
        </AbsoluteLayout>
    </ContentPage.Content>
</ContentPage>